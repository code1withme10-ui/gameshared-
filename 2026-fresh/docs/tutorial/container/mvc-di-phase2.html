<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CodeWithMe – Architectural Training Series</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- W3.CSS CDN -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <style>
        body { font-family: Arial, sans-serif; }
        .section-title { border-left: 5px solid #009688; padding-left: 10px; margin-bottom: 10px; }
        .w3-card { border-radius: 8px; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 20px; }

        .terminal {
            background: #000;
            color: #00ff88;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            overflow-x: auto;
            white-space: pre-line;
        }

        .ai-prompt {
            font-family: monospace;
            white-space: pre-line;
        }
    </style>
</head>
<body class="w3-light-grey">

<!-- Header -->
<div class="w3-container w3-teal w3-padding-32">
    <h1>CodeWithMe – Architectural Training Series</h1>
    <p class="w3-large">Dependency Injection – Phase 2</p>
</div>

<div class="w3-container w3-margin-top w3-margin-bottom">

    <!-- Step 1: Modify Index.php -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Step 1: Inject Service from index.php</h2>
        <p>Update <strong>public/index.php</strong> to create the service and inject it into the controller:</p>
        <div class="w3-panel w3-pale-green w3-border ai-prompt">
1. Before routing, create the service:
   $messageService = new MessageService();

2. When creating the controller, pass the service in:
   $controller = new MessageController($messageService);

3. Keep all routes and Router dispatch code unchanged.

Note:
- You are acting as the composition root.
- Controller no longer creates the service.
- This keeps the Controller decoupled and testable.
        </div>
    </div>

    <!-- Step 2: Verification -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Step 2: Verification</h2>
        <ul class="w3-ul">
            <li>Controller constructor now receives <strong>$messageService</strong></li>
            <li>No <strong>new MessageService()</strong> inside the Controller</li>
            <li>Application behavior remains the same when navigating /messages or /messages/create</li>
            <li>Routing continues to work as expected</li>
        </ul>
        <div class="w3-panel w3-pale-yellow w3-border">
            You have now completed manual dependency injection from the composition root.
        </div>
    </div>

    <!-- Step 3: Workspace / Terminal -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Step 3: Workspace Commands</h2>
        <p>Make sure you are in the tutorial folder and server is running:</p>
        <div class="terminal">
cd /var/www/tutorial/containers
php -S localhost:8000 -t public/
        </div>
        <p>Open the browser and test:</p>
        <div class="terminal">
http://localhost:8000/messages
http://localhost:8000/messages/create
        </div>
    </div>

    <!-- Step 4: Reflection -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Step 4: Reflection</h2>
        <ul class="w3-ul">
            <li>Controller no longer decides how to create its dependencies</li>
            <li>Index.php acts as the composition root, controlling object creation</li>
            <li>This mirrors what you learned in the Container chapter but done manually</li>
        </ul>
        <div class="w3-panel w3-pale-blue w3-border">
            Manual DI through the composition root improves maintainability and prepares you for automated DI later.
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
        <a class="w3-button w3-teal" href="mvc-di-phase1.html">← Previous</a>
        <a class="w3-button w3-teal" href="mvc-di-phase3.html">Next →</a>
    </div>

</div>

<!-- Footer -->
<div class="w3-container w3-teal w3-padding-16 w3-center">
    <p>CodeWithMe – Manual Dependency Injection completed successfully.</p>
</div>

</body>
</html>

