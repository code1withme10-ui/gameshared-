<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MVC & Routing – Phase 4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- W3.CSS CDN -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <style>
        body { font-family: Arial, sans-serif; }
        .section-title { border-left: 5px solid #009688; padding-left: 10px; margin-bottom: 10px; }
        .w3-card { border-radius: 8px; }
        .terminal {
            background: #000;
            color: #00ff88;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            overflow-x: auto;
        }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 20px; }
    </style>
</head>
<body class="w3-light-grey">

<!-- Header -->
<div class="w3-container w3-teal w3-padding-32">
    <h1>CodeWithMe – Architectural Training Series</h1>
    <p class="w3-large">Phase 4 – Introduce Model / Storage</p>
</div>

<!-- Main Content -->
<div class="w3-container w3-margin-top w3-margin-bottom">

    <!-- Objective -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Objective</h2>
        <p>
            In this phase, we introduce a <strong>Model</strong> to handle message storage.
            Messages will be saved in a JSON file for persistence.
        </p>
        <div class="w3-panel w3-pale-blue w3-border">
            Controller now delegates data handling to the model.
        </div>
    </div>

    <!-- What Must Change -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">What Must Change / Key Concepts</h2>

        <ul class="w3-ul">
            <li>Create <strong>/app/models/MessageModel.php</strong></li>
            <li>Methods: all(), find($id), create($data)</li>
            <li>Use JSON file <strong>/storage/messages.json</strong> for storage</li>
            <li>Update MessageController to call MessageModel methods</li>
            <li>Router remains unchanged</li>
        </ul>

        <p>Example MessageModel:</p>
        <div class="terminal">
&lt;?php
class MessageModel {
    private static $file = __DIR__ . '/../../../storage/messages.json';

    // Return all messages
    public static function all() {
        if (!file_exists(self::$file)) return [];
        return json_decode(file_get_contents(self::$file), true);
    }

    // Find message by ID
    public static function find($id) {
        $messages = self::all();
        return $messages[$id] ?? null;
    }

    // Create new message
    public static function create($data) {
        $messages = self::all();
        $messages[] = $data;
        file_put_contents(self::$file, json_encode($messages, JSON_PRETTY_PRINT));
    }
}
        </div>

        <div class="w3-panel w3-pale-green w3-border">
            Model separates data from controller logic.
        </div>
    </div>

    <!-- AI Guidance -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">AI Prompt / Guidance for Learner</h2>

        <div class="w3-panel w3-pale-red w3-border">
            Paste full current index.php, Router.php, Controller.php, MessageController.php into AI first.
        </div>

        <p>Then instruct AI:</p>
        <div class="terminal">
Phase 4 – Introduce Model / Storage

1. Create /app/models/MessageModel.php as above
2. Update MessageController methods:
   - index() → fetch messages via MessageModel::all()
   - create() → show sender form
   - store() → call MessageModel::create() after sending message
3. Ensure Router still dispatches correctly
4. Preserve sender.php functionality
5. Keep code minimal and commented
        </div>
    </div>

    <!-- Verification -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">What to Check / Verification Steps</h2>

        <ol>
            <li>Start server:</li>
        </ol>
        <div class="terminal">
php -S localhost:8000 -t /var/www/tutorial/containers/public/
        </div>

        <ol start="2">
            <li>Visit sender form:</li>
        </ol>
        <div class="terminal">
http://localhost:8000/messages/create
        </div>

        <ol start="3">
            <li>Submit a message via form</li>
        </ol>

        <ol start="4">
            <li>Visit message list:</li>
        </ol>
        <div class="terminal">
http://localhost:8000/messages
        </div>

        <ol start="5">
            <li>Confirm submitted message appears with type and timestamp</li>
        </ol>

        <ol start="6">
            <li>Check storage file:</li>
        </ol>
        <div class="terminal">
/storage/messages.json
        </div>

        <div class="w3-panel w3-pale-green w3-border">
            Model integration is working if messages persist between requests.
        </div>
    </div>

    <!-- Terminology -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Terminology</h2>
        <ul class="w3-ul">
            <li><strong>Model</strong> – Handles data storage and retrieval</li>
            <li><strong>Persistence</strong> – Keeping data between requests</li>
            <li><strong>JSON file</strong> – Simple storage format for learning purposes</li>
        </ul>
    </div>

    <!-- Reflection -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Reflection</h2>
        <p>
            How does introducing a model improve maintainability compared to putting all logic in Controller?
        </p>
        <div class="w3-panel w3-pale-yellow w3-border">
            Separation of concerns: Controller focuses on request handling, Model focuses on data.
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
        <a class="w3-button w3-teal" href="mvc-routing-phase3.html">Previous</a>
        <a class="w3-button w3-teal" href="mvc-routing-phase5.html">Next</a>
    </div>

</div>

<!-- Footer -->
<div class="w3-container w3-teal w3-padding-16 w3-center">
    <p>CodeWithMe – Learn architecture professionally. Tools do not control you.</p>
</div>

</body>
</html>

