<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CodeWithMe – Architectural Training Series</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- W3.CSS CDN -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <style>
        body { font-family: Arial, sans-serif; }
        .section-title { border-left: 5px solid #009688; padding-left: 10px; margin-bottom: 10px; }
        .w3-card { border-radius: 8px; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 20px; }

        .terminal {
            background: #000;
            color: #00ff88;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            overflow-x: auto;
            white-space: pre-line;
        }

        .ai-prompt {
            font-family: monospace;
            white-space: pre-line;
        }
    </style>
</head>
<body class="w3-light-grey">

<div class="w3-container w3-teal w3-padding-32">
    <h1>CodeWithMe – Architectural Training Series</h1>
    <p class="w3-large">Service Layer – Phase 4</p>
</div>

<div class="w3-container w3-margin-top w3-margin-bottom">

    <!-- Objective -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Objective</h2>

        <p>
            Finalize the Service Layer refactor and confirm clean architecture.
        </p>

        <ul class="w3-ul">
            <li>Verify Controller is lightweight</li>
            <li>Confirm Service handles business logic</li>
            <li>Ensure application behavior is unchanged</li>
        </ul>

        <div class="w3-panel w3-pale-green w3-border">
            We improve architecture without changing functionality.
        </div>
    </div>

    <!-- Architectural Review -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Architectural Review</h2>

        <p>Your Controller should now:</p>

        <ul class="w3-ul">
            <li>Receive request data</li>
            <li>Call MessageService</li>
            <li>Redirect or render view</li>
        </ul>

        <p>Your Service should now:</p>

        <ul class="w3-ul">
            <li>Execute CLI</li>
            <li>Call MessageModel</li>
            <li>Return result</li>
        </ul>

        <div class="terminal">
Controller
   ↓
Service
   ↓       ↓
CLI     Model
        </div>
    </div>

    <!-- Cleanup -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Cleanup Checklist</h2>

        <ul class="w3-ul">
            <li>Remove any remaining shell_exec() calls from Controller</li>
            <li>Remove direct MessageModel calls from Controller</li>
            <li>Confirm MessageService handles both responsibilities</li>
            <li>Ensure no duplicate logic exists</li>
        </ul>

        <div class="w3-panel w3-pale-yellow w3-border">
            The Controller must not contain business logic anymore.
        </div>
    </div>

    <!-- Testing -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Full Application Test</h2>

        <p>Restart server:</p>

        <div class="terminal">
cd /var/www/tutorial/containers
php -S localhost:8000 -t public/
        </div>

        <ul class="w3-ul">
            <li>Create new message</li>
            <li>Verify CLI status displays</li>
            <li>Confirm message stored in messages.json</li>
            <li>Check message list page</li>
            <li>Check individual message view</li>
        </ul>

        <div class="w3-panel w3-pale-green w3-border">
            If all features work, refactor was successful.
        </div>
    </div>

    <!-- AI Verification Prompt -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Optional AI Verification</h2>

        <div class="w3-panel w3-pale-green w3-border ai-prompt">
Review my current:
- MessageController.php
- MessageService.php
- MessageModel.php

Confirm:
1. Controller contains no business logic
2. Service handles CLI + Model
3. Architecture follows MVC + Service pattern
Do not redesign the project.
Only verify separation of concerns.
        </div>

        <div class="w3-panel w3-pale-blue w3-border">
            This reinforces architectural discipline.
        </div>
    </div>

    <!-- Reflection -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Reflection</h2>

        <ul class="w3-ul">
            <li>Is the Controller easier to read now?</li>
            <li>Where does business logic live?</li>
            <li>How would this design scale?</li>
            <li>What layer would change if we replaced CLI with an API?</li>
        </ul>

        <div class="w3-panel w3-pale-blue w3-border">
            Architecture is about managing change safely.
        </div>
    </div>

    <!-- Chapter Complete -->
    <div class="w3-card w3-white w3-padding w3-margin-bottom">
        <h2 class="section-title">Chapter Complete</h2>

        <p>
            You have successfully introduced a Service Layer into your MVC application.
        </p>

        <p>
            Your system now follows:
        </p>

        <div class="terminal">
Routing
Controller
Service
Model
Infrastructure (CLI)
        </div>

        <div class="w3-panel w3-pale-green w3-border">
            This is the foundation of professional backend architecture.
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
        <a class="w3-button w3-teal" href="mvc-service-phase3.html">← Previous</a>
        <a class="w3-button w3-teal" href="#">Next →</a>
    </div>

</div>

<div class="w3-container w3-teal w3-padding-16 w3-center">
    <p>CodeWithMe – Architecture is about clarity, not complexity.</p>
</div>

</body>
</html>
